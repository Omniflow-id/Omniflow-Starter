Instruksi Implementasi 2FA Email OTP (Admin Login)

1. Environment Variables
------------------------
Tambahkan variable berikut di .env file:

# SMTP Configuration (sesuaikan)
SMTP_USER=youremail@gmail.com
SMTP_PASS=your-email-password-or-app-password

# Dev Mode Bypass
DEV_2FA_BYPASS=true    # Ubah ke false di production

2. Install Dependencies
------------------------
npm install nodemailer

3. Modify Login Flow
------------------------
Di file login.js (controller login admin):
- Setelah password valid, tambahkan:
  a. Jika DEV_2FA_BYPASS === true:
     - Langsung set req.session.user dan redirect ke /admin (tanpa OTP)
  b. Jika DEV_2FA_BYPASS === false:
     - Generate 6-digit OTP.
     - Kirim OTP ke email admin via Nodemailer.
     - Simpan OTP dan expired time di req.session.pending2FA.
     - Redirect ke /admin/verify-otp (halaman input OTP).

4. OTP Verification Route
------------------------
Buat route GET /admin/verify-otp:
  - Cek apakah req.session.pending2FA ada, jika tidak, redirect ke /login.
  - Render form input OTP.

Buat route POST /admin/verify-otp:
  a. Jika DEV_2FA_BYPASS === true:
     - Langsung set req.session.user dan redirect ke /admin.
  b. Jika DEV_2FA_BYPASS === false:
     - Validasi OTP dengan req.session.pending2FA.otp.
     - Cek apakah OTP expired.
     - Jika valid, set req.session.user, hapus pending2FA, redirect ke /admin.
     - Jika salah, berikan error dan redirect ulang ke /admin/verify-otp.

5. OTP Generation & Email Sending
------------------------
Buat function helper untuk:
  - Generate random 6-digit OTP.
  - Kirim email via Nodemailer dengan subject "Your OTP Code".

6. Session Structure
------------------------
Session sementara yang digunakan:
  req.session.pending2FA = {
    userId: user.id,
    email: user.email,
    otp: '123456',
    expiresAt: <timestamp>, // expired time in ms
  };

Session setelah OTP sukses:
  req.session.user = {
    id: user.id,
    username: user.username,
    email: user.email,
    role: user.role,
  };

7. Development Tips
------------------------
- Selama development, aktifkan DEV_2FA_BYPASS=true agar tidak perlu OTP setiap kali login.
- Di production, pastikan DEV_2FA_BYPASS=false untuk mengaktifkan OTP email.

8. Security Notes
------------------------
- OTP hanya berlaku 5 menit dan sekali pakai.
- Jangan kirim OTP di URL (hanya via email).
- Simpan OTP di session (in-memory) atau Redis jika ingin lebih scalable.
- Rate limit endpoint OTP jika ada public exposure (optional).
- Saat production, pertimbangkan upgrade ke TOTP (Google Authenticator) untuk level keamanan lebih tinggi.

