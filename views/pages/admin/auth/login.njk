<!DOCTYPE html>
<html lang="{{ currentLang or 'en' }}">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>{{ pageTitle }} - {{ appName }}</title>
    <link rel="icon" href="/img/logomark-blue.svg" />
    <link href="/css/styles.css" rel="stylesheet" />
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/js/all.min.js"
      integrity="sha512-uKQ39gEGiyUJl4AI6L+ekBdGKpGw4xJ55+xyJG7YFlJokPNYegn9KwQ3P8A7aFQAUtUsAQHep+d/lrGqrbPIDQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <style>
      #togglePassword {
        transition: background-color 0.2s ease;
        height: calc(3.5rem + 2px);
        display: flex;
        align-items: center;
        justify-content: center;
      }
      #togglePassword:hover {
        background-color: #0b5ed7;
        width: 100%;
      }
      #togglePassword:active {
        background-color: #0a58ca;
      }
      #inputPassword {
        border-top-right-radius: 0;
        border-bottom-right-radius: 0;
      }
      .input-group-append .btn {
        border-top-left-radius: 0;
        border-bottom-left-radius: 0;
      }
      .input-group .form-floating {
        flex: 1 1 auto;
        width: 1%;
      }
      .input-group .form-floating > .form-control {
        border-top-right-radius: 0;
        border-bottom-right-radius: 0;
      }
      .lang-switcher {
        position: absolute;
        top: 20px;
        right: 20px;
        z-index: 1000;
      }
    </style>
  </head>
  <body>
    <!-- Language Switcher -->
    <div class="lang-switcher">
      <div class="btn-group shadow-sm" role="group" aria-label="Language switcher">
        {% for lang in languages %}
        <a
          href="{{ lang.href if lang.href else '#' }}"
          class="btn btn-sm btn-light {{ 'active fw-bold text-primary' if lang.isActive else 'text-muted' }}"
          {{ 'aria-current="page"' if lang.isActive else '' }}
          title="{{ lang.name }}"
        >
          <span class="me-1">{{ lang.flag }}</span> {{ lang.shortLabel }}
        </a>
        {% endfor %}
      </div>
    </div>

    <div id="layoutAuthentication">
      <div id="layoutAuthentication_content">
        <main>
          <div class="container">
            <div class="row justify-content-center">
              <div class="col-lg-5">
                <div class="card shadow-lg border-0 rounded-lg mt-5">
                  <div class="card-header">
                    <img
                      src="/img/logomark-blue.svg"
                      alt="{{ appName }}"
                      class="img-fluid mx-auto d-block"
                      style="width: 100px; height: 100px"
                    />
                    <h3 class="text-center font-weight-light my-4">{{ title }}</h3>
                  </div>
                  <div class="card-body">
                    {% include "components/alert_flash_message.njk" %}
                    <form id="login-form" action="/admin/login{% if currentLang %}?lang={{ currentLang }}{% endif %}" method="post">
                      {{ csrfField() | safe }}
                      <div class="form-floating mb-3">
                        <input
                          class="form-control"
                          id="inputEmail"
                          type="email"
                          name="email"
                          placeholder="{{ labels.emailPlaceholder or 'name@example.com' }}"
                        />
                        <label for="inputEmail">{{ labels.emailAddress or 'Email address' }}</label>
                      </div>
                      <div class="form-floating mb-3">
                        <div class="input-group">
                          <div class="form-floating">
                            <input
                              type="password"
                              class="form-control"
                              id="inputPassword"
                              name="password"
                              placeholder="{{ password or 'Password' }}"
                              required
                            />
                            <label for="inputPassword">{{ password or 'Password' }}</label>
                          </div>
                          <div class="input-group-append">
                            <button
                              class="btn btn-primary"
                              type="button"
                              id="togglePassword"
                              style="width: 42px"
                            >
                              <i class="fas fa-eye"></i>
                            </button>
                          </div>
                        </div>
                      </div>
                      <div class="mt-4 mb-0">
                        <button
                          id="login-button"
                          class="btn btn-primary w-100"
                          type="submit"
                        >
                          {{ loginButton or 'Login' }}
                        </button>
                      </div>
                    </form>
                  </div>
                  <div class="card-footer text-center py-3">
                    <div class="small">
                      {{ footer.needAccount or 'Need an account? Please contact your administrator' }}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>
    <!-- Add loading spinner -->
    <div
      class="position-fixed top-0 start-0 w-100 h-100 d-none"
      id="login-loading"
      style="background: rgba(0, 0, 0, 0.5); z-index: 9999"
    >
      <div class="d-flex justify-content-center align-items-center h-100">
        <div
          class="spinner-border text-primary"
          role="status"
          style="width: 3rem; height: 3rem"
        >
          <span class="visually-hidden">{{ labels.loading or 'Loading...' }}</span>
        </div>
      </div>
    </div>

    <script src="/js/bootstrap.bundle.min.js"></script>
    <script>
      // Handle login form submission
      const loginForm = document.getElementById("login-form");
      const loginButton = document.getElementById("login-button");

      loginForm.addEventListener("submit", function (e) {
        // Show loading state
        document.getElementById("login-loading").classList.remove("d-none");
        loginButton.disabled = true;
        loginButton.innerHTML = '{{ labels.loggingIn or "Logging in..." }}';
      });

      // Toggle password visibility
      const togglePassword = document.getElementById("togglePassword");
      const passwordInput = document.getElementById("inputPassword");

      togglePassword.addEventListener("click", function () {
        const type =
          passwordInput.getAttribute("type") === "password"
            ? "text"
            : "password";
        passwordInput.setAttribute("type", type);
        const icon = this.querySelector("i");
        icon.classList.toggle("fa-eye");
        icon.classList.toggle("fa-eye-slash");
      });
    </script>
  </body>
</html>
