<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Login - {{ appName }}</title>
    <link rel="icon" href="/img/logo.png" />
    <link href="/css/styles.css" rel="stylesheet" />
    <script
    src="/js/font-awesome-all.js"
    ></script>
    <style>
      #togglePassword {
        transition: background-color 0.2s ease;
        height: calc(3.5rem + 2px);
        display: flex;
        align-items: center;
        justify-content: center;
      }
      #togglePassword:hover {
        background-color: #0b5ed7;
      }
      #togglePassword:active {
        background-color: #0a58ca;
      }
      #inputPassword {
        border-top-right-radius: 0;
        border-bottom-right-radius: 0;
      }
      .input-group-append .btn {
        border-top-left-radius: 0;
        border-bottom-left-radius: 0;
      }
      .input-group .form-floating {
        flex: 1 1 auto;
        width: 1%;
      }
      .input-group .form-floating > .form-control {
        border-top-right-radius: 0;
        border-bottom-right-radius: 0;
      }
    </style>
  </head>
  <body>
    <div id="layoutAuthentication">
      <div id="layoutAuthentication_content">
        <main>
          <div class="container">
            <div class="row justify-content-center">
              <div class="col-lg-5">
                <div class="card shadow-lg border-0 rounded-lg mt-5">
                  <div class="card-header">
                    <img
                      src="/img/logo.png"
                      alt="{{ appName }}"
                      class="img-fluid mx-auto d-block"
                      style="width: 100px; height: 100px"
                    />
                    <h3 class="text-center font-weight-light my-4">Login</h3>
                  </div>
                  <div class="card-body">
                    {% include "components/alert_flash_message.njk" %}
                    <form id="login-form" action="/admin/login" method="post">
                      {{ csrfField() | safe }}
                      <div class="form-floating mb-3">
                        <input
                          class="form-control"
                          id="inputEmail"
                          type="email"
                          name="email"
                          placeholder="name@example.com"
                        />
                        <label for="inputEmail">Email address</label>
                      </div>
                      <div class="form-floating mb-3">
                        <div class="input-group">
                          <div class="form-floating">
                            <input
                              type="password"
                              class="form-control"
                              id="inputPassword"
                              name="password"
                              placeholder="Password"
                              required
                            />
                            <label for="inputPassword">Password</label>
                          </div>
                          <div class="input-group-append">
                            <button
                              class="btn btn-primary"
                              type="button"
                              id="togglePassword"
                              style="width: 42px"
                            >
                              <i class="fas fa-eye"></i>
                            </button>
                          </div>
                        </div>
                      </div>
                      <div class="mt-4 mb-0">
                        <button
                          id="login-button"
                          class="btn btn-primary w-100"
                          type="submit"
                        >
                          Login
                        </button>
                      </div>
                    </form>
                  </div>
                  <div class="card-footer text-center py-3">
                    <div class="small">
                      Need an account? Please contact your administrator
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>
    <!-- Add loading spinner -->
    <div
      class="position-fixed top-0 start-0 w-100 h-100 d-none"
      id="login-loading"
      style="background: rgba(0, 0, 0, 0.5); z-index: 9999"
    >
      <div class="d-flex justify-content-center align-items-center h-100">
        <div
          class="spinner-border text-primary"
          role="status"
          style="width: 3rem; height: 3rem"
        >
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>
    </div>

    <script src="/js/bootstrap.bundle.min.js"></script>
    <script>
      // Handle login form submission
      const loginForm = document.getElementById("login-form");
      const loginButton = document.getElementById("login-button");

      loginForm.addEventListener("submit", function (e) {
        // Show loading state
        document.getElementById("login-loading").classList.remove("d-none");
        loginButton.disabled = true;
        loginButton.innerHTML = "Logging in...";
      });

      // Toggle password visibility
      const togglePassword = document.getElementById("togglePassword");
      const passwordInput = document.getElementById("inputPassword");

      togglePassword.addEventListener("click", function () {
        const type =
          passwordInput.getAttribute("type") === "password"
            ? "text"
            : "password";
        passwordInput.setAttribute("type", type);
        const icon = this.querySelector("i");
        icon.classList.toggle("fa-eye");
        icon.classList.toggle("fa-eye-slash");
      });
    </script>
  </body>
</html>
